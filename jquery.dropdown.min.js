/*!
 * jquery dropdown 1.0
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses. (LICENSES.txt)
 */
(function(e){var f={speed:250,maxElements:10,activeText:'<span class="dropdown_arrow"/>',namespace:".dropdown",highlight:function(h,g){return h.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+g.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}},d=27,c=13,a=38,b=40;e.fn.dropdown=function(g){var g=e.extend({},f,g);return this.each(function(){var C=e(this),F=[],t=[],j,y,o,B,x,v,E,h,p,r=function(){e('<span class="dropdown_wrap"/>').insertAfter(C).append(y=e('<span class="dropdown_active"/>').bind("click"+g.namespace,w),j=e('<div class="dropdown" style="position:absolute;left:-9999px"/>').bind("mouseleave"+g.namespace,A).append(B=e('<input type="text" class="dropdown_search"/>').bind("keydown"+g.namespace,k).bind("keyup"+g.namespace,D).bind("blur"+g.namespace,G).bind("focus"+g.namespace,w),o=e('<div class="dropdown_list"/>')));var I=0,H=0;C.hide().bind("change"+g.namespace,m).find("option").each(function(){var N=e(this),K=N.html(),M=N.val(),L=N.attr("selected");F[I]={name:K,value:M};F[I].element=e('<div class="dropdown_option">'+K+"</div>").data({index:I,entry:I}).bind("click"+g.namespace,q).bind("mouseenter"+g.namespace,i).appendTo(o);t.push(F[I].element);if(L){H=I}I++});u(H);if(F.length<g.maxElements){z()}E=F[0].element.outerHeight();var J=E*g.maxElements;o.css("max-height",J)},u=function(J){var I=F[J].name+g.activeText;var H;y.html(I);if(x){H=x.removeClass("active")}x=F[J].element.addClass("active");if(H&&x!=H){C.val(F[J].value).change()}G()},q=function(){var H=e(this).data("entry");u(H)},z=function(){B.css({position:"absolute",left:-9999});p=true},w=function(){if(h){return}h=true;j.hide().css({left:0}).fadeIn(g.speed);i.call(x);B.focus()},G=function(){if(!h){return}setTimeout(function(){j.fadeOut(g.speed,function(){j.css({left:-9999}).show()});h=false},100)},i=function(){if(v){A()}v=e(this).addClass("hover")},A=function(){v.removeClass("hover");v=null},n=function(){if(v){var H=v.data("index"),I=H+1;if(I==t.length){return}var J=t[I];i.call(J);s(I)}else{i.call(t[0]);s(0)}},l=function(){if(v){var H=v.data("index");if(!H){return}var I=H-1,J=t[I];i.call(J);s(I)}else{var K=t.length-1;i.call(t[K]);s(K)}},s=function(J){if(t.length<g.maxElements){return}var I=o.scrollTop(),H=E*g.maxElements,L=H+I-E,K=J*E;if(K<I){o.scrollTop(K)}if(K>L){o.scrollTop(K-H+E)}},k=function(I){if(!h){return}var H=I.keyCode;if(H==d||H==c||H==a||H==b){I.preventDefault()}if(H==d){G();return false}else{if(H==c){q.call(v);G();return false}else{if(H==a){l()}else{if(H==b){n()}}}}},m=function(){var H=C.val();e.each(F,function(I,J){if(J.value==H){q.call(J.element);return}})},D=function(J){var I=J.keyCode;if(p||I==d||I==c||I==a||I==b){return}var K=B.val().toLowerCase(),H=0;t=[];e.each(F,function(M,N){if(N.name.toLowerCase().indexOf(K)>-1){var L=g.highlight(N.name,K);t.push(N.element.html(L).show().data("index",H++))}else{N.element.hide()}});if(t.length){i.call(t[0])}};r()})}})(jQuery);