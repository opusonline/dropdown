/*!
 * jquery dropdown 1.0
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses. (LICENSES.txt)
 */
(function(e){var f={speed:250,maxElements:10,searchField:"auto",activeText:'<span class="dropdown_arrow"/>',namespace:".dropdown",highlight:function(h,g){return h.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+g.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}},d=27,c=13,a=38,b=40;e.fn.dropdown=function(g){var g=e.extend({},f,g);return this.each(function(){var D=e(this),H=[],s=[],j,z,n,C,y,w,G,h,o,F=true,u,q=function(){e('<span class="dropdown_wrap"/>').insertAfter(D).append(z=e('<span class="dropdown_active"/>').bind("click"+g.namespace,x),j=e('<div class="dropdown" style="position:absolute;left:-9999px"/>').bind("mouseleave"+g.namespace,B).append(C=e('<input type="text" class="dropdown_search"/>').bind("keydown"+g.namespace,k).bind("keyup"+g.namespace,E).bind("blur"+g.namespace,I).bind("focus"+g.namespace,x),n=e('<div class="dropdown_list"/>')));var K=0,J=0;D.hide().bind("valchange"+g.namespace,v).find("option").each(function(){var P=e(this),M=P.html(),O=P.val(),N=P.attr("selected");H[K]={name:M,value:O};H[K].element=e('<div class="dropdown_option">'+M+"</div>").data({index:K,entry:K}).bind("click"+g.namespace,p).bind("mouseenter"+g.namespace,i).appendTo(n);s.push(H[K].element);if(N){J=K}K++});t(J);if(!g.searchField||(g.maxElements!="all"&&g.searchField=="auto"&&H.length<g.maxElements)){A()}G=H[0].element.outerHeight();if(g.maxElements!="all"){var L=G*g.maxElements;n.css("max-height",L)}},t=function(L){var K=H[L].name+g.activeText;var J;z.html(K);if(y){J=y.removeClass("active")}y=H[L].element.addClass("active");if(J&&y!=J){D.val(H[L].value);if(F){D.change()}F=true}I()},p=function(){var J=e(this).data("entry");t(J)},A=function(){C.css({position:"absolute",left:-9999});o=true},x=function(){if(h){return}h=true;j.hide().css({left:0}).fadeIn(g.speed);i.call(y);C.focus()},I=function(){if(!h){return}h=false;u=setTimeout(function(){j.css({left:-9999}).show()},100)},i=function(){if(w){B()}w=e(this).addClass("hover")},B=function(){w.removeClass("hover");w=null},m=function(){if(w){var J=w.data("index"),K=J+1;if(K==s.length){return}var L=s[K];i.call(L);r(K)}else{i.call(s[0]);r(0)}},l=function(){if(w){var J=w.data("index");if(!J){return}var K=J-1,L=s[K];i.call(L);r(K)}else{var M=s.length-1;i.call(s[M]);r(M)}},r=function(L){if(g.maxElements=="all"||(g.maxElements!="all"&&s.length<g.maxElements)){return}var K=n.scrollTop(),J=G*g.maxElements,N=J+K-G,M=L*G;if(M<K){n.scrollTop(M)}if(M>N){n.scrollTop(M-J+G)}},k=function(K){if(!h){return}var J=K.keyCode;if(J==d||J==c||J==a||J==b){K.preventDefault()}if(J==d){I();return false}else{if(J==c){p.call(w);I();return false}else{if(J==a){l()}else{if(J==b){m()}}}}},v=function(){var J=D.val();e.each(H,function(K,L){if(L.value==J){F=false;p.call(L.element);return}})},E=function(L){var K=L.keyCode;if(o||K==d||K==c||K==a||K==b){return}var M=C.val().toLowerCase(),J=0;s=[];e.each(H,function(O,P){if(P.name.toLowerCase().indexOf(M)>-1){var N=g.highlight(P.name,M);s.push(P.element.html(N).show().data("index",J++))}else{P.element.hide()}});if(s.length){i.call(s[0])}};q()})}})(jQuery);