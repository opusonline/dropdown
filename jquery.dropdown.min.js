/*!
 * jquery dropdown 1.0
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses. (LICENSES.txt)
 */
(function(e){var f={speed:250,maxElements:10,activeText:'<span class="dropdown_arrow"/>',namespace:".dropdown",highlight:function(h,g){return h.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+g.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}},d=27,c=13,a=38,b=40;e.fn.dropdown=function(g){var g=e.extend({},f,g);return this.each(function(){var B=e(this),E=[],s=[],j,x,n,A,w,u,D,h,o,q=function(){e('<span class="dropdown_wrap"/>').insertAfter(B).append(x=e('<span class="dropdown_active"/>').bind("click"+g.namespace,v),j=e('<div class="dropdown" style="position:absolute;left:-9999px"/>').bind("mouseleave"+g.namespace,z).append(A=e('<input type="text" class="dropdown_search"/>').bind("keydown"+g.namespace,k).bind("keyup"+g.namespace,C).bind("blur"+g.namespace,F).bind("focus"+g.namespace,v),n=e('<div class="dropdown_list"/>')));var H=0,G=0;B.hide().find("option").each(function(){var M=e(this),J=M.html(),L=M.val(),K=M.attr("selected");E[H]={name:J,value:L};E[H].element=e('<div class="dropdown_option">'+J+"</div>").data({index:H,entry:H}).bind("click"+g.namespace,p).bind("mouseenter"+g.namespace,i).appendTo(n);s.push(E[H].element);if(K){G=H}H++});t(G);if(E.length<g.maxElements){y()}D=E[0].element.outerHeight();var I=D*g.maxElements;n.css("max-height",I)},t=function(H){var G=E[H].name+g.activeText;x.html(G);if(w){w.removeClass("active")}w=E[H].element.addClass("active");B.val(E[H].value);F()},p=function(){var G=e(this).data("entry");t(G)},y=function(){A.css({position:"absolute",left:-9999});o=true},v=function(){if(h){return}h=true;j.hide().css({left:0}).fadeIn(g.speed);i.call(w);A.focus()},F=function(){if(!h){return}setTimeout(function(){j.fadeOut(g.speed,function(){j.css({left:-9999}).show()});h=false},100)},i=function(){if(u){z()}u=e(this).addClass("hover")},z=function(){u.removeClass("hover");u=null},m=function(){if(u){var G=u.data("index"),H=G+1;if(H==s.length){return}var I=s[H];i.call(I);r(H)}else{i.call(s[0]);r(0)}},l=function(){if(u){var G=u.data("index");if(!G){return}var H=G-1,I=s[H];i.call(I);r(H)}else{var J=s.length-1;i.call(s[J]);r(J)}},r=function(I){if(s.length<g.maxElements){return}var H=n.scrollTop(),G=D*g.maxElements,K=G+H-D,J=I*D;if(J<H){n.scrollTop(J)}if(J>K){n.scrollTop(J-G+D)}},k=function(H){if(!h){return}var G=H.keyCode;if(G==d||G==c||G==a||G==b){H.preventDefault()}if(G==d){F();return false}else{if(G==c){p.call(u);F();return false}else{if(G==a){l()}else{if(G==b){m()}}}}},C=function(I){var H=I.keyCode;if(o||H==d||H==c||H==a||H==b){return}var J=A.val().toLowerCase(),G=0;s=[];e.each(E,function(L,M){if(M.name.toLowerCase().indexOf(J)>-1){var K=g.highlight(M.name,J);s.push(M.element.html(K).show().data("index",G++))}else{M.element.hide()}});if(s.length){i.call(s[0])}};q()})}})(jQuery);